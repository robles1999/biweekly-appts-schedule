<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Biweekly Appointment Visualizer</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='20' width='80' height='70' rx='8' fill='%234F46E5'/><line x1='30' y1='15' x2='30' y2='30' stroke='white' stroke-width='4'/><line x1='70' y1='15' x2='70' y2='30' stroke='white' stroke-width='4'/><line x1='10' y1='40' x2='90' y2='40' stroke='white' stroke-width='3'/><rect x='20' y='50' width='12' height='12' fill='white'/><rect x='44' y='50' width='12' height='12' fill='white'/><rect x='68' y='50' width='12' height='12' fill='white'/><rect x='20' y='70' width='12' height='12' fill='white'/></svg>"
      type="image/svg+xml"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-8 transition-colors duration-300"
  >
    <div class="max-w-6xl mx-auto">
      <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8 transition-colors duration-300"
      >
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-3">
            <svg
              class="w-8 h-8 text-blue-600 dark:text-blue-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">
              Biweekly Appointment Visualizer
            </h1>
          </div>
          <button
            id="themeToggle"
            class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
          >
            <svg
              id="sunIcon"
              class="w-6 h-6 text-gray-800 dark:text-gray-200 hidden"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg
              id="moonIcon"
              class="w-6 h-6 text-gray-800 dark:text-gray-200 hidden"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
        </div>

        <div class="grid md:grid-cols-2 gap-6 mb-6">
          <div>
            <label
              class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"
            >
              First Appointment Date (MM-DD-YYYY)
            </label>
            <div class="flex gap-1 sm:gap-2 items-center">
              <input
                type="text"
                id="month"
                placeholder="MM"
                maxlength="2"
                class="w-14 sm:w-16 px-2 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none transition-colors text-center bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-sm"
              />
              <span class="text-gray-500 dark:text-gray-400 font-bold text-sm"
                >-</span
              >
              <input
                type="text"
                id="day"
                placeholder="DD"
                maxlength="2"
                class="w-14 sm:w-16 px-2 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none transition-colors text-center bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-sm"
              />
              <span class="text-gray-500 dark:text-gray-400 font-bold text-sm"
                >-</span
              >
              <input
                type="text"
                id="year"
                placeholder="YYYY"
                maxlength="4"
                class="w-20 sm:w-24 px-2 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none transition-colors text-center bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-sm"
              />
            </div>
            <div
              id="dateError"
              class="text-red-600 dark:text-red-400 text-sm mt-2 hidden"
            ></div>
          </div>

          <div>
            <label
              class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"
            >
              End Year
            </label>
            <input
              type="number"
              id="endYear"
              placeholder="2025"
              min="2024"
              max="2030"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-blue-500 dark:focus:border-blue-400 focus:outline-none transition-colors bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"
            />
          </div>
        </div>

        <button
          onclick="generateSchedule()"
          class="w-full bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md"
        >
          Generate Schedule
        </button>

        <div
          id="appointmentSummary"
          class="hidden mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg transition-colors"
        >
          <p
            class="text-sm font-semibold text-blue-900 dark:text-blue-200"
            id="totalAppointments"
          ></p>
          <p
            class="text-xs text-blue-700 dark:text-blue-300 mt-1"
            id="dateRange"
          ></p>
        </div>

        <div
          class="mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg transition-colors"
        >
          <h3
            class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"
          >
            Legend
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="flex items-center gap-2">
              <div
                class="w-6 h-6 bg-blue-600 dark:bg-blue-500 rounded shadow-sm flex-shrink-0"
              ></div>
              <span class="text-xs text-gray-700 dark:text-gray-300"
                >Appointment</span
              >
            </div>
            <div class="flex items-center gap-2">
              <div
                class="w-6 h-6 bg-red-600 dark:bg-red-700 rounded shadow-sm flex-shrink-0"
              ></div>
              <span class="text-xs text-gray-700 dark:text-gray-300"
                >Appointment on Holiday</span
              >
            </div>
            <div class="flex items-center gap-2">
              <div
                class="w-6 h-6 bg-gray-50 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 flex items-center justify-center flex-shrink-0"
              >
                <span
                  class="text-xs text-red-600 dark:text-red-400 font-semibold"
                  >H</span
                >
              </div>
              <span class="text-xs text-gray-700 dark:text-gray-300"
                >Holiday</span
              >
            </div>
            <div class="flex items-center gap-2">
              <div
                class="w-6 h-6 bg-gray-50 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 flex items-center justify-center flex-shrink-0"
              >
                <span class="text-xs text-gray-700 dark:text-gray-300">D</span>
              </div>
              <span class="text-xs text-gray-700 dark:text-gray-300"
                >Regular Day</span
              >
            </div>
          </div>
        </div>
      </div>

      <div
        id="calendarContainer"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
      ></div>
    </div>

    <script>
      var appointments = [];

      // Theme toggle functionality
      function initTheme() {
        var theme = localStorage.getItem("theme");
        if (!theme) {
          // Default to dark mode
          theme = "dark";
        }
        applyTheme(theme);
      }

      function applyTheme(theme) {
        var html = document.documentElement;
        var sunIcon = document.getElementById("sunIcon");
        var moonIcon = document.getElementById("moonIcon");

        if (theme === "dark") {
          html.classList.add("dark");
          sunIcon.classList.remove("hidden");
          moonIcon.classList.add("hidden");
        } else {
          html.classList.remove("dark");
          sunIcon.classList.add("hidden");
          moonIcon.classList.remove("hidden");
        }
        localStorage.setItem("theme", theme);
      }

      document
        .getElementById("themeToggle")
        .addEventListener("click", function () {
          var currentTheme = document.documentElement.classList.contains("dark")
            ? "dark"
            : "light";
          var newTheme = currentTheme === "dark" ? "light" : "dark";
          applyTheme(newTheme);
        });

      // Initialize theme on load
      initTheme();

      // US Federal Holidays
      function getHolidays(year) {
        var holidays = [];

        // Fixed date holidays
        holidays.push(new Date(year, 0, 1)); // New Year's Day
        holidays.push(new Date(year, 6, 4)); // Independence Day
        holidays.push(new Date(year, 10, 11)); // Veterans Day
        holidays.push(new Date(year, 11, 25)); // Christmas

        // MLK Day - 3rd Monday in January
        holidays.push(getNthWeekdayOfMonth(year, 0, 1, 3));

        // Presidents Day - 3rd Monday in February
        holidays.push(getNthWeekdayOfMonth(year, 1, 1, 3));

        // Memorial Day - Last Monday in May
        holidays.push(getLastWeekdayOfMonth(year, 4, 1));

        // Labor Day - 1st Monday in September
        holidays.push(getNthWeekdayOfMonth(year, 8, 1, 1));

        // Columbus Day - 2nd Monday in October
        holidays.push(getNthWeekdayOfMonth(year, 9, 1, 2));

        // Thanksgiving - 4th Thursday in November
        holidays.push(getNthWeekdayOfMonth(year, 10, 4, 4));

        return holidays;
      }

      function getNthWeekdayOfMonth(year, month, weekday, n) {
        var date = new Date(year, month, 1);
        var count = 0;
        while (date.getMonth() === month) {
          if (date.getDay() === weekday) {
            count++;
            if (count === n) {
              return new Date(date);
            }
          }
          date.setDate(date.getDate() + 1);
        }
        return null;
      }

      function getLastWeekdayOfMonth(year, month, weekday) {
        var date = new Date(year, month + 1, 0);
        while (date.getDay() !== weekday) {
          date.setDate(date.getDate() - 1);
        }
        return date;
      }

      function isHoliday(date, month, year) {
        var holidays = getHolidays(year);
        return holidays.some(function (holiday) {
          return (
            holiday.getDate() === date &&
            holiday.getMonth() === month &&
            holiday.getFullYear() === year
          );
        });
      }

      // Auto-advance and validation for date inputs
      document.getElementById("month").addEventListener("input", function (e) {
        var value = e.target.value.replace(/\D/g, "");
        if (value.length >= 2) {
          var month = parseInt(value);
          if (month > 12) {
            e.target.value = "12";
          } else if (month < 1) {
            e.target.value = "01";
          } else {
            e.target.value = value.padStart(2, "0");
          }
          document.getElementById("day").focus();
          validateDate();
        } else {
          e.target.value = value;
        }
      });

      document.getElementById("day").addEventListener("input", function (e) {
        var value = e.target.value.replace(/\D/g, "");
        if (value.length >= 2) {
          e.target.value = value;
          validateDate();
          var isValid = document
            .getElementById("dateError")
            .classList.contains("hidden");
          if (isValid) {
            document.getElementById("year").focus();
          }
        } else {
          e.target.value = value;
        }
      });

      document.getElementById("year").addEventListener("input", function (e) {
        var value = e.target.value.replace(/\D/g, "");
        e.target.value = value;
        if (value.length === 4) {
          validateDate();
        }
      });

      function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
      }

      function getDaysInMonth(month, year) {
        var daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        if (month === 2 && isLeapYear(year)) {
          return 29;
        }
        return daysInMonth[month - 1];
      }

      function validateDate() {
        var monthInput = document.getElementById("month").value;
        var dayInput = document.getElementById("day").value;
        var yearInput = document.getElementById("year").value;
        var errorDiv = document.getElementById("dateError");

        if (!monthInput || !dayInput || !yearInput) {
          errorDiv.classList.add("hidden");
          return false;
        }

        var month = parseInt(monthInput);
        var day = parseInt(dayInput);
        var year = parseInt(yearInput);

        if (month < 1 || month > 12) {
          errorDiv.textContent = "Month must be between 1 and 12";
          errorDiv.classList.remove("hidden");
          return false;
        }

        var maxDays = getDaysInMonth(month, year);
        if (day < 1 || day > maxDays) {
          var monthNames = [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
            "August",
            "September",
            "October",
            "November",
            "December",
          ];
          errorDiv.textContent =
            monthNames[month - 1] +
            " " +
            year +
            " only has " +
            maxDays +
            " days";
          errorDiv.classList.remove("hidden");
          return false;
        }

        if (year < 2024 || year > 2030) {
          errorDiv.textContent = "Year must be between 2024 and 2030";
          errorDiv.classList.remove("hidden");
          return false;
        }

        errorDiv.classList.add("hidden");
        return true;
      }

      function generateSchedule() {
        var monthInput = document.getElementById("month").value;
        var dayInput = document.getElementById("day").value;
        var yearInput = document.getElementById("year").value;
        var endYearInput = document.getElementById("endYear").value;

        if (!validateDate()) {
          alert("Please enter a valid date");
          return;
        }

        if (!endYearInput) {
          alert("Please enter an end year");
          return;
        }

        var dateString =
          yearInput +
          "-" +
          monthInput.padStart(2, "0") +
          "-" +
          dayInput.padStart(2, "0");
        var startDate = new Date(dateString + "T00:00:00");
        appointments = [];
        var current = new Date(startDate);
        var endYear = parseInt(endYearInput);

        while (current.getFullYear() <= endYear) {
          appointments.push(new Date(current));
          current.setDate(current.getDate() + 14);
        }

        appointments = appointments.filter(function (date) {
          return date.getFullYear() <= endYear;
        });

        displayAppointmentSummary();
        displayCalendars();
      }

      function displayAppointmentSummary() {
        var summary = document.getElementById("appointmentSummary");
        var total = document.getElementById("totalAppointments");
        var range = document.getElementById("dateRange");

        // Clear previous content
        summary.innerHTML = "";
        var totalP = document.createElement("p");
        totalP.className =
          "text-sm font-semibold text-blue-900 dark:text-blue-200";
        totalP.id = "totalAppointments";
        summary.appendChild(totalP);

        var rangeP = document.createElement("p");
        rangeP.className = "text-xs text-blue-700 dark:text-blue-300 mt-1";
        rangeP.id = "dateRange";
        summary.appendChild(rangeP);

        total = document.getElementById("totalAppointments");
        range = document.getElementById("dateRange");

        if (appointments.length > 0) {
          summary.classList.remove("hidden");
          total.textContent = "Total Appointments: " + appointments.length;
          range.textContent =
            appointments[0].toLocaleDateString() +
            " - " +
            appointments[appointments.length - 1].toLocaleDateString();

          // Count holidays
          var holidayCount = 0;
          for (var i = 0; i < appointments.length; i++) {
            if (
              isHoliday(
                appointments[i].getDate(),
                appointments[i].getMonth(),
                appointments[i].getFullYear()
              )
            ) {
              holidayCount++;
            }
          }

          if (holidayCount > 0) {
            var warningText = document.createElement("p");
            warningText.className =
              "text-sm font-semibold text-red-600 dark:text-red-400 mt-2";
            warningText.textContent =
              "Warning: " +
              holidayCount +
              " appointment(s) fall on holidays (shown in red)";
            summary.appendChild(warningText);
          }
        }
      }

      function getMonthsToDisplay() {
        if (appointments.length === 0) return [];

        var months = [];
        var firstDate = appointments[0];
        var lastDate = appointments[appointments.length - 1];

        var current = new Date(
          firstDate.getFullYear(),
          firstDate.getMonth(),
          1
        );
        var end = new Date(lastDate.getFullYear(), lastDate.getMonth(), 1);

        while (current <= end) {
          months.push(new Date(current));
          current.setMonth(current.getMonth() + 1);
        }

        return months;
      }

      function isAppointmentDate(date, month, year) {
        return appointments.some(function (apt) {
          return (
            apt.getDate() === date &&
            apt.getMonth() === month &&
            apt.getFullYear() === year
          );
        });
      }

      function renderCalendar(monthDate) {
        var year = monthDate.getFullYear();
        var month = monthDate.getMonth();
        var firstDay = new Date(year, month, 1).getDay();
        var daysInMonth = new Date(year, month + 1, 0).getDate();

        var monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];

        var calendarHTML =
          '<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 transition-colors">' +
          '<h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3">' +
          monthNames[month] +
          " " +
          year +
          "</h3>" +
          '<div class="grid grid-cols-7 gap-1 mb-1">';

        var dayHeaders = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        for (var i = 0; i < dayHeaders.length; i++) {
          calendarHTML +=
            '<div class="text-center font-semibold text-gray-600 dark:text-gray-400 text-xs">' +
            dayHeaders[i] +
            "</div>";
        }

        calendarHTML += '</div><div class="grid grid-cols-7 gap-1">';

        for (var i = 0; i < firstDay; i++) {
          calendarHTML += '<div class="aspect-square"></div>';
        }

        for (var date = 1; date <= daysInMonth; date++) {
          var isAppt = isAppointmentDate(date, month, year);
          var isHol = isHoliday(date, month, year);
          var classes = "";

          if (isAppt && isHol) {
            classes =
              "bg-red-600 dark:bg-red-700 text-white text-lg font-bold shadow-lg";
          } else if (isAppt) {
            classes =
              "bg-blue-600 dark:bg-blue-500 text-white text-lg font-bold shadow-lg";
          } else if (isHol) {
            classes =
              "bg-gray-50 dark:bg-gray-700 text-red-600 dark:text-red-400 text-xs font-semibold";
          } else {
            classes =
              "bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs hover:bg-gray-100 dark:hover:bg-gray-600";
          }

          calendarHTML +=
            '<div class="aspect-square flex items-center justify-center rounded transition-all ' +
            classes +
            '">' +
            date +
            "</div>";
        }

        calendarHTML += "</div></div>";
        return calendarHTML;
      }

      function displayCalendars() {
        var container = document.getElementById("calendarContainer");

        if (appointments.length === 0) {
          container.innerHTML = "";
          return;
        }

        var html =
          '<div class="col-span-full"><h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4">Appointment Calendar</h2></div>';

        var months = getMonthsToDisplay();
        for (var i = 0; i < months.length; i++) {
          html += renderCalendar(months[i]);
        }

        container.innerHTML = html;
      }
    </script>
  </body>
</html>
